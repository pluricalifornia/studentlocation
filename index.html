<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Summer School Student Locations - Regional Boundaries</title>
    <link rel="stylesheet" href="https://js.arcgis.com/4.29/esri/themes/light/main.css">
    <script src="https://js.arcgis.com/4.29/"></script>
    <style>
        html, body, #mapDiv {
            padding: 0;
            margin: 0;
            height: 100%;
            width: 100%;
            font-family: Arial, sans-serif;
        }
        
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 100;
            max-width: 250px;
        }
        
        .legend-title {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 10px;
            color: #333;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin: 8px 0;
            font-size: 14px;
        }
        
        .legend-symbol {
            width: 20px;
            height: 15px;
            margin-right: 8px;
            border: 1px solid #333;
        }
        
        .color-very-high { background-color: rgba(231, 76, 60, 0.7); }
        .color-high { background-color: rgba(243, 156, 18, 0.7); }
        .color-medium { background-color: rgba(52, 152, 219, 0.7); }
        .color-low { background-color: rgba(46, 204, 113, 0.7); }
        .color-international { background-color: rgba(155, 89, 182, 0.7); }
        
        #stats {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 100;
            max-width: 300px;
        }
        
        .stats-title {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 10px;
            color: #333;
        }
        
        .stats-item {
            font-size: 14px;
            margin: 5px 0;
            color: #555;
        }

        #tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 14px;
            pointer-events: none;
            z-index: 1000;
            display: none;
        }
    </style>
</head>
<body>
    <div id="mapDiv"></div>
    <div id="tooltip"></div>
    
    <div id="legend">
        <div class="legend-title">Student Distribution</div>
        <div class="legend-item">
            <div class="legend-symbol color-very-high"></div>
            <span>10+ Students</span>
        </div>
        <div class="legend-item">
            <div class="legend-symbol color-high"></div>
            <span>5-9 Students</span>
        </div>
        <div class="legend-item">
            <div class="legend-symbol color-medium"></div>
            <span>2-4 Students</span>
        </div>
        <div class="legend-item">
            <div class="legend-symbol color-low"></div>
            <span>1 Student</span>
        </div>
        <div class="legend-item">
            <div class="legend-symbol color-international"></div>
            <span>International</span>
        </div>
    </div>
    
    <div id="stats">
        <div class="stats-title">Summary Statistics</div>
        <div class="stats-item"><strong>Total Students:</strong> 31</div>
        <div class="stats-item"><strong>California:</strong> 26 (83.9%)</div>
        <div class="stats-item"><strong>Bay Area:</strong> 12 (38.7%)</div>
        <div class="stats-item"><strong>Los Angeles:</strong> 7 (22.6%)</div>
        <div class="stats-item"><strong>Other States:</strong> 4 (12.9%)</div>
        <div class="stats-item"><strong>International:</strong> 1 (3.2%)</div>
        <div class="stats-item"><strong>Total Regions:</strong> 10</div>
    </div>

    <script>
        require([
            "esri/Map",
            "esri/views/MapView",
            "esri/Graphic",
            "esri/layers/GraphicsLayer",
            "esri/geometry/Polygon",
            "esri/PopupTemplate"
        ], function(Map, MapView, Graphic, GraphicsLayer, Polygon, PopupTemplate) {
            
            // Create map
            const map = new Map({
                basemap: "streets-navigation-vector"
            });
            
            // Create map view
            const view = new MapView({
                container: "mapDiv",
                map: map,
                center: [-119, 37],
                zoom: 5
            });
            
            // Create graphics layer
            const graphicsLayer = new GraphicsLayer();
            map.add(graphicsLayer);

            // Regional boundary data with approximate coordinates
            const regionBoundaries = [
                {
                    name: "Bay Area",
                    state: "CA",
                    students: 12,
                    coordinates: [
                        [[-123.5, 38.5], [-121.5, 38.5], [-121.5, 37.2], [-122.8, 36.8], [-123.5, 37.8], [-123.5, 38.5]]]
                },
                {
                    name: "Los Angeles",
                    state: "CA", 
                    students: 7,
                    coordinates: [
                        [[-119.5, 34.8], [-117.0, 34.8], [-117.0, 33.2], [-119.5, 33.2], [-119.5, 34.8]]]
                },
                {
                    name: "Central Coast",
                    state: "CA",
                    students: 2,
                    coordinates: [
                        [[-122.8, 36.8], [-119.5, 36.8], [-119.5, 34.8], [-122.0, 34.0], [-122.8, 35.5], [-122.8, 36.8]]]
                },
                {
                    name: "Inland Empire", 
                    state: "CA",
                    students: 2,
                    coordinates: [
                        [[-117.0, 34.8], [-116.0, 34.8], [-116.0, 33.2], [-117.0, 33.2], [-117.0, 34.8]]]
                },
                {
                    name: "San Diego",
                    state: "CA",
                    students: 2,
                    coordinates: [
                        [[-118.0, 33.2], [-116.0, 33.2], [-116.0, 32.0], [-118.0, 32.0], [-118.0, 33.2]]]
                },
                {
                    name: "Sacramento",
                    state: "CA", 
                    students: 1,
                    coordinates: [
                        [[-122.5, 39.5], [-120.5, 39.5], [-120.5, 37.8], [-122.5, 37.8], [-122.5, 39.5]]]
                },
                {
                    name: "Washington State",
                    state: "WA",
                    students: 2,
                    coordinates: [
                        [[-125.0, 49.0], [-116.9, 49.0], [-116.9, 45.5], [-124.8, 45.5], [-125.0, 49.0]]]
                },
                {
                    name: "Colorado State",
                    state: "CO",
                    students: 1,
                    coordinates: [
                        [[-109.0, 41.0], [-102.0, 41.0], [-102.0, 37.0], [-109.0, 37.0], [-109.0, 41.0]]]
                },
                {
                    name: "Washington",
                    state: "D.C.",
                    students: 1,
                    coordinates: [
                        [[-77.2, 39.0], [-76.9, 39.0], [-76.9, 38.8], [-77.2, 38.8], [-77.2, 39.0]]]
                },
                {
                    name: "Mexico City",
                    state: "Mexico",
                    students: 1,
                    coordinates: [
                        [[-99.5, 19.8], [-98.8, 19.8], [-98.8, 19.1], [-99.5, 19.1], [-99.5, 19.8]]]
                }
            ];

            // Function to get fill color and opacity based on student count
            function getFillSymbol(students, state) {
                let color;
                
                if (state === "Mexico") {
                    color = [155, 89, 182, 0.7]; // Purple for international
                } else if (students >= 10) {
                    color = [231, 76, 60, 0.7]; // Red for very high count
                } else if (students >= 5) {
                    color = [243, 156, 18, 0.7]; // Orange for high count  
                } else if (students >= 2) {
                    color = [52, 152, 219, 0.7]; // Blue for medium count
                } else {
                    color = [46, 204, 113, 0.7]; // Green for single student
                }
                
                return {
                    type: "simple-fill",
                    color: color,
                    outline: {
                        color: [255, 255, 255],
                        width: 2
                    }
                };
            }

            // Add regional boundaries to map
            regionBoundaries.forEach(region => {
                const polygon = new Polygon({
                    rings: region.coordinates
                });
                
                const popupTemplate = new PopupTemplate({
                    title: `${region.name}${region.state !== 'CA' ? ', ' + region.state : ''}`,
                    content: `
                        <div style="padding: 10px;">
                            <p><strong>Students:</strong> ${region.students}</p>
                            <p><strong>Region:</strong> ${region.name}${region.state !== 'CA' ? ', ' + region.state : ''}</p>
                            <p><strong>Percentage:</strong> ${((region.students / 31) * 100).toFixed(1)}% of total</p>
                            ${region.state === "CA" ? '<p><em>California region</em></p>' : ''}
                            ${region.state === "Mexico" ? '<p><em>International students</em></p>' : ''}
                            ${region.name === "Bay Area" ? '<p><em>Largest regional concentration</em></p>' : ''}
                        </div>
                    `
                });
                
                const graphic = new Graphic({
                    geometry: polygon,
                    symbol: getFillSymbol(region.students, region.state),
                    popupTemplate: popupTemplate,
                    attributes: {
                        name: region.name,
                        state: region.state,
                        students: region.students
                    }
                });
                
                graphicsLayer.add(graphic);
            });

            // Add hover effects
            let tooltip = document.getElementById('tooltip');
            
            view.on("pointer-move", function(event) {
                view.hitTest(event).then(function(response) {
                    if (response.results.length > 0) {
                        const graphic = response.results[0].graphic;
                        if (graphic && graphic.attributes && graphic.attributes.name) {
                            tooltip.style.display = 'block';
                            tooltip.style.left = event.x + 10 + 'px';
                            tooltip.style.top = event.y - 30 + 'px';
                            tooltip.innerHTML = `
                                <strong>${graphic.attributes.name}</strong><br>
                                ${graphic.attributes.students} student${graphic.attributes.students > 1 ? 's' : ''}
                            `;
                            view.container.style.cursor = 'pointer';
                        }
                    } else {
                        tooltip.style.display = 'none';
                        view.container.style.cursor = 'default';
                    }
                });
            });

            view.on("pointer-leave", function() {
                tooltip.style.display = 'none';
                view.container.style.cursor = 'default';
            });
            
            // Adjust view to show all regions
            view.when(() => {
                view.goTo(graphicsLayer.graphics, {
                    duration: 2000
                });
            });
        });
    </script>
</body>
</html>
